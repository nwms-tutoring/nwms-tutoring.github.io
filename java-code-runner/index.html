<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JDoodle Web IDE</title>
  <style>
    body {
      font-family: monospace;
      background-color: #1e1e1e;
      color: #ccc;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #111;
      padding: 1em;
      text-align: center;
    }
    textarea, pre {
      width: 100%;
      box-sizing: border-box;
      padding: 1em;
      background-color: #2d2d2d;
      color: #f1f1f1;
      font-size: 14px;
      border: none;
      resize: vertical;
    }
    button {
      background: #4CAF50;
      color: white;
      padding: 10px 20px;
      margin: 1em;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    pre {
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <header>
    <h2>JDoodle Web IDE (Prototype)</h2>
  </header>

  <textarea id="code" rows="15">
// Write Python code here
print("Hello from JDoodle!")
  </textarea>
  
  <button onclick="runCode()">Run</button>
  <pre id="output">Output will appear here...</pre>

  <script>
    // Obfuscated (Base64 â†’ Hex) credentials
    const obfuscated = {
      // clientId: 'f7c8db43537069cffbc84dec51988ef8'
      clientId: '5a6a64376a4f477252694e44334d314d7a63334f6a6c6a5a6d5a69597a67345a47466a',
      
      // clientSecret: 'd9bdca504bf155b5c93b804244828aa25db922fb1ca6f846c187ead1d6292eb2'
      clientSecret: '5a476377636e52706347784f5467395955475a6c63326430596a45704f5745346147464e5a7a46505a4751315a32566c6332786c4f6a646c59584a68624842776447686c5957356a5a53426e'
    };

    // Decode from hex to Base64, then decode Base64
    function decodeCredential(hexStr) {
      const hexBytes = hexStr.match(/.{1,2}/g).map(b => parseInt(b, 16));
      const base64 = String.fromCharCode(...hexBytes);
      return atob(base64);
    }

    async function runCode() {
      const output = document.getElementById("output");
      const code = document.getElementById("code").value;

      output.textContent = "Running...";

      const clientId = decodeCredential(obfuscated.clientId);
      const clientSecret = decodeCredential(obfuscated.clientSecret);

      const payload = {
        clientId: clientId,
        clientSecret: clientSecret,
        script: code,
        language: "python3",
        versionIndex: "3"
      };

      try {
        const res = await fetch("https://api.jdoodle.com/v1/execute", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        const result = await res.json();
        output.textContent = result.output || "[No output received]";
      } catch (error) {
        output.textContent = "Error: " + error.message;
      }
    }
  </script>
</body>
</html>
